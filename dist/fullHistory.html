<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Station | Full History</title>
    <link rel="stylesheet" href="css/style.css?v=16">
</head>

<body>
    <div class="wrapper">
        <nav class="nav navbar-expand-md navbar-light bg-primary mb-4">
            <div class="container">
                <button class="navbar-toggler w-100" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item btn btn-primary"><a class="nav-link" href="index.html">Home</a></li>
                        <li class="nav-item btn btn-primary"><a class="nav-link" href="history.html">History</a></li>
                        <li class="nav-item btn btn-primary"><a class="nav-link active" href="#">Full History</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <main class="container">
            <h1>Weather Station <small>- full history</small></h1>
            <nav class="nav navbar-expand-sm navbar-light d-lg-none mb-4">
                <ul class="navbar-nav btn-group btn-group-sm" role="group">
                    <li type="button" class="nav-item btn btn-sm btn-outline-primary"><a class="text-decoration-none" href="#temperature-title">Temperature</a></li>
                    <li type="button" class="nav-item btn btn-sm btn-outline-primary"><a class="text-decoration-none" href="#pressure-title">Pressure</a></li>
                    <li type="button" class="nav-item btn btn-sm btn-outline-primary"><a class="text-decoration-none" href="#lightlvl-title">Light Level</a></li>
                </ul>
            </nav>

            <nav id="pagination-nav-top" class="pagination-nav" aria-label="Pagination">
                <ul class="pagination pagination-sm">
                    <li class="page-item">
                        <button class="page-link" aria-label="Previous" value="previous">
                            <span aria-hidden="true">&laquo;</span>
                            <span class="sr-only">Previous</span>
                        </button>
                    </li>

                    <li class="page-item"><button class="page-link" value="1">1</button></li>
                    <li class="page-item disabled"><button class="page-link">...</button></li>
                    <li class="page-item"><button class="page-link" value="2">2</button></li>
                    <li class="page-item"><button class="page-link" value="3">3</button></li>
                    <li class="page-item"><button class="page-link" value="4">4</button></li>
                    <li class="page-item disabled"><button class="page-link">...</button></li>
                    <li class="page-item"><button class="page-link" value="100">100</button></li>

                    <li class="page-item">
                        <button class="page-link" href="#" aria-label="Next"  value="next">
                            <span aria-hidden="true">&raquo;</span>
                            <span class="sr-only">Next</span>
                        </button>
                    </li>
                </ul>
            </nav>

            <div class="d-flex flex-column flex-lg-row">
                <div class="col px-0">
                    <div class="d-flex flex-row align-items-center">
                        <h2 id="temperature-title">Temperature</h2>
                        <div class="flex-fill"></div>
                        <button class="btn btn-sm btn-outline-primary d-lg-none"><a class="text-decoration-none" href="#">Back to top</a></button>
                    </div>
                    <table class="table table-sm">
                        <thead class="thead-light">
                        <tr>
                            <th scope="col">Date</th>
                            <th scope="col">Time</th>
                            <th scope="col">Location</th>
                            <th scope="col">Temperature [&deg;C]</th>
                        </tr>
                        </thead>

                        <tbody id="temperature">
                        </tbody>
                    </table>
                </div>
                <div class="col px-0 px-lg-4">
                    <div class="d-flex flex-row align-items-center">
                        <h2 id="pressure-title">Pressure</h2>
                        <div class="flex-fill"></div>
                        <button class="btn btn-sm btn-outline-primary d-lg-none"><a class="text-decoration-none" href="#">Back to top</a></button>
                    </div>
                    <table class="table table-sm">
                        <thead class="thead-light">
                            <tr>
                                <th scope="col">Date</th>
                                <th scope="col">Time</th>
                                <th scope="col">Location</th>
                                <th scope="col">Pressure [hPa]</th>
                            </tr>
                        </thead>

                        <tbody id="pressure">
                        </tbody>
                    </table>
                </div>
                <div class="col px-0">
                    <div class="d-flex flex-row align-items-center">
                        <h2 id="lightlvl-title">Light Level</h2>
                        <div class="flex-fill"></div>
                        <button class="btn btn-sm btn-outline-primary d-lg-none"><a class="text-decoration-none" href="#">Back to top</a></button>
                    </div>
                    <table class="table table-sm">
                        <thead class="thead-light">
                            <tr>
                                <th scope="col">Date</th>
                                <th scope="col">Time</th>
                                <th scope="col">Location</th>
                                <th scope="col">Light&nbsp;Level [lux]</th>
                            </tr>
                        </thead>
                        <tbody id="lightlvl">
                        </tbody>
                    </table>
                </div>
            </div>

            <nav id="pagination-nav-bottom" class="pagination-nav" aria-label="Pagination">
                <ul class="pagination pagination-sm">
                    <li class="page-item">
                        <button class="page-link" aria-label="Previous" value="previous">
                            <span aria-hidden="true">&laquo;</span>
                            <span class="sr-only">Previous</span>
                        </button>
                    </li>

                    <li class="page-item"><button class="page-link" value="1">1</button></li>
                    <li class="page-item disabled"><button class="page-link">...</button></li>
                    <li class="page-item"><button class="page-link" value="2">2</button></li>
                    <li class="page-item"><button class="page-link" value="3">3</button></li>
                    <li class="page-item"><button class="page-link" value="4">4</button></li>
                    <li class="page-item disabled"><button class="page-link">...</button></li>
                    <li class="page-item"><button class="page-link" value="100">100</button></li>

                    <li class="page-item">
                        <button class="page-link" href="#" aria-label="Next"  value="next">
                            <span aria-hidden="true">&raquo;</span>
                            <span class="sr-only">Next</span>
                        </button>
                    </li>
                </ul>
            </nav>
        </main>

        <div class="flex-fill"></div>

        <footer class="bg-primary">
            <div class="container">
                <p class="text-center p-3 m-0 mt-2">
                    &copy; Johan Torfs
                </p>
            </div>
        </footer>
    </div>

    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script>
        var pageNumber = 1;
        var maxPageNumber;

        function updatePage(jsonList, id) {
            $('#' + id).text("");
            jsonList.forEach(function(item) {
                let row = $('#' + id).append('<tr></tr>');
                row.append('<td>' + item.date + '</td>');
                row.append('<td>' + item.time + '</td>');
                row.append('<td>' + item.location + '</td>');
                row.append('<td>' + item.value + '</td>');
            });
        };

        function update() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    var res = JSON.parse(this.responseText);

                    maxPageNumber = res.maxPageNumber;
                    $('.pagination-nav').each(function() {
                        let pagList = $(this).find('>ul');
                        pagList.find('li:nth-child(8) button').val(maxPageNumber).text(maxPageNumber);
                    });
                    updatePage(res.temperature, 'temperature');
                    updatePage(res.pressure, 'pressure');
                    updatePage(res.lightlevel, 'lightlvl');

                }
            };
            xhttp.open("GET", "php/updateFullHistory.php?pageNumber=" + pageNumber, true);
            xhttp.send();
        };

        function updatePagination(toPage) {
            toPage = parseInt(toPage);
            pageNumber = toPage;
            update();

            $('.pagination-nav').each(function() {
                let pagList = $(this).find('>ul');
                let previous = pagList.find('li:first-child');
                let next = pagList.find('li:last-child');

                pagList.find('li').each(function () {
                    $(this).removeClass('active');
                });

                pagList.find('li:nth-child(3)').show();
                pagList.find('li:nth-child(7)').show();

                if (toPage == 1) {
                    previous.addClass('disabled');
                    pagList.find('li:nth-child(2)').addClass('active');
                    pagList.find('li:nth-child(3)').hide();
                    pagList.find('li:nth-child(4) button').val(2).text(2);
                    pagList.find('li:nth-child(5) button').val(3).text(3);
                    pagList.find('li:nth-child(6) button').val(4).text(4);
                } else {
                    previous.removeClass('disabled');
                    if (toPage == 2) {
                        pagList.find('li:nth-child(3)').hide();
                        pagList.find('li:nth-child(4) button').val(2).text(2);
                        pagList.find('li:nth-child(4)').addClass('active')
                        pagList.find('li:nth-child(5) button').val(3).text(3);
                        pagList.find('li:nth-child(6) button').val(4).text(4);
                    } else {
                        if (toPage == 3) {
                            pagList.find('li:nth-child(3)').hide();
                            pagList.find('li:nth-child(4) button').val(2).text(2);
                            pagList.find('li:nth-child(5) button').val(3).text(3).addClass('active');
                            pagList.find('li:nth-child(5)').addClass('active')
                            pagList.find('li:nth-child(6) button').val(4).text(4);
                        } else {
                            if (toPage == maxPageNumber) {
                                next.addClass('disabled');
                                pagList.find('li:nth-child(4) button').val(maxPageNumber - 3).text(maxPageNumber - 3);
                                pagList.find('li:nth-child(5) button').val(maxPageNumber - 2).text(maxPageNumber - 2);
                                pagList.find('li:nth-child(6) button').val(maxPageNumber - 1).text(maxPageNumber - 1);
                                pagList.find('li:nth-child(7)').hide();
                                pagList.find('li:nth-child(8)').addClass('active');
                            } else {
                                next.removeClass('disabled');
                                if (toPage == (maxPageNumber - 1)) {
                                    pagList.find('li:nth-child(4) button').val(maxPageNumber - 3).text(maxPageNumber - 3);
                                    pagList.find('li:nth-child(5) button').val(maxPageNumber - 2).text(maxPageNumber - 2);
                                    pagList.find('li:nth-child(6) button').val(maxPageNumber - 1).text(maxPageNumber - 1);
                                    pagList.find('li:nth-child(6)').addClass('active');
                                    pagList.find('li:nth-child(7)').hide();
                                } else {
                                    if (toPage == (maxPageNumber - 2)) {
                                        pagList.find('li:nth-child(4) button').val(maxPageNumber - 3).text(maxPageNumber - 3);
                                        pagList.find('li:nth-child(5) button').val(maxPageNumber - 2).text(maxPageNumber - 2);
                                        pagList.find('li:nth-child(5)').addClass('active');
                                        pagList.find('li:nth-child(6) button').val(maxPageNumber - 1).text(maxPageNumber - 1);
                                        pagList.find('li:nth-child(7)').hide();
                                    } else {
                                        var i;
                                        for (i = -1; i < 2; i++) {
                                            pagList.find('li:nth-child(' + (5 + i).toString() + ') button').val(toPage + i);
                                            pagList.find('li:nth-child(' + (5 + i).toString() + ') button').text(toPage + i);
                                        }
                                        pagList.find('li:nth-child(5)').addClass('active')
                                    }
                                }
                            }
                        }
                    }
                }
            });
        };

        $(function() {
            updatePagination(1);

            $('.page-link').click(function () {
                let value = $(this).val();
                if (value === "previous") {
                    updatePagination(pageNumber - 1);
                } else if (value == "next") {
                    updatePagination(pageNumber + 1);
                } else {
                    updatePagination(value);
                }
            });
        });
    </script>
</body>

</html>
